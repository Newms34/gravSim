"use strict";var app=angular.module("gravapp",[]).controller("grav-cont",["$scope","$interval",function(a,n){a.w=$(window).width(),a.h=$(window).height(),a.ticks=0,a.numPlans=15,a.maxSize=100,a.g=.1,a.timer=null,a.sunStatus=!1,a.mSun=200,a.canv=document.querySelector("#canv").getContext("2d"),a.rescatter=function(){a.plans=[],a.hidePlans=!1;for(var l=0;l<a.numPlans;l++)a.plans.push(new a.newPlan);a.plans.forEach(function(n){n.x=Math.floor(Math.random()*a.w),n.y=Math.floor(Math.random()*a.h),n.dx=Math.random()-.5,n.dy=Math.random()-.5}),a.timer=n(function(){a.ticks++;for(var l=a.plans.length,t=!1,e=0;e<l;e++){if(!a.plans[e])return!1;if(!a.plans[e])return!1;(a.plans[e].x+a.plans[e].dx<0||a.plans[e].x+a.plans[e].dx>a.w)&&(a.plans[e].dx*=-1),(a.plans[e].y+a.plans[e].dy<0||a.plans[e].y+a.plans[e].dy>a.h)&&(a.plans[e].dy*=-1),a.plans[e].x+=a.plans[e].dx,a.plans[e].y+=a.plans[e].dy;for(var s=0;s<l;s++)if(e!=s&&(a.plans[e]&&a.plans[s]||console.log("comparing",a.plans[e],"and",a.plans[s]),!(o=a.getGrav(a.plans[e],a.plans[s]))||0==o||"false"==o)){t=!0,console.log("Objects",a.plans[e],"and",a.plans[s],"merged!"),a.plans[e]=a.combine(a.plans[e],a.plans[s]),a.plans.splice(s,1);break}if(a.sunStatus){var o=a.getGrav(a.plans[e],a.sun,!0);o&&"false"!=o||(a.plans.splice(e,1),t=!0)}if(a.pathMode){a.canv.globalCompositeOperation="screen",a.canv.fillStyle="hsla("+60*a.plans[e].m/a.maxSize+",100%,"+100*a.plans[e].m/a.maxSize+"%,.2)";var i=Math.ceil(a.plans[e].m/8);a.canv.fillRect(a.plans[e].x+.05*a.plans[e].m,a.plans[e].y+.05*a.plans[e].m,i,i)}if(t)break}a.ticks%5==0&&(a.canv.globalCompositeOperation="multiply",a.canv.fillStyle="rgba(0,0,0,0.1)",a.canv.fillRect(0,0,a.w,a.h)),(a.plans.length<2||a.sunStatus&&!a.plans.length)&&(n.cancel(a.timer),bootbox.alert({title:"System Crashed!",message:"Your system has only one particle left!"}))},50)},a.getGrav=function(n,l,t){var e=10*n.m/a.maxSize;if(t)s=a.sun.m/2;else var s=10*l.m/a.maxSize;var o=Math.sqrt(Math.pow(Math.abs(n.x-l.x),2)+Math.pow(Math.abs(n.y-l.y),2));if(o<e+s)return console.log("COLLIDE! DIST IS:",o,"MIN RANGE IS",e+s),!1;var i=a.g*l.m/Math.pow(o,2),r=Math.atan(Math.abs(n.y-l.y)/Math.abs(n.x-l.x));return n.x>=l.x&&n.y<=l.y||(r=n.x<l.x&&n.y<=l.y?Math.PI-r:n.x>=l.x&&n.y>l.y?2*Math.PI-r:Math.PI+r),r=2*Math.PI-r,n.dx-=i*Math.cos(r),n.dy-=i*Math.sin(r),n.dx=Math.min(20,n.dx),n.dy=Math.min(20,n.dy),n},a.noBubble=function(a){a.stopPropagation()},a.mouse={x:0,y:0},a.mousey=function(n){a.mouse.x=n.clientX,a.mouse.y=n.clientY},a.moving=!1,a.toggleMove=function(n){if(a.moving)a.moving.x=n.clientX,a.moving.y=n.clientY,console.log("re-adding",a.moving),a.plans.push(angular.copy(a.moving)),a.moving=!1;else{console.log(n.target.id.slice(2),n);var l=n.target.id.slice(2);console.log(a.plans.length),a.moving=a.plans.splice(l,1)[0],console.log(a.plans.length)}},a.combine=function(a,n){if(n.m>a.m){var l=angular.copy(n);n=angular.copy(a),a=angular.copy(l)}var t={x:.5*a.m*Math.pow(a.dx,2)+.5*n.m*Math.pow(n.dx,2),y:.5*a.m*Math.pow(a.dy,2)+.5*n.m*Math.pow(n.dy,2)},e={x:.7*t.x/(a.m+n.m),y:.7*t.y/(a.m+n.m)};return console.log("COLLISION:",a,n,t,e),a.dx=e.x,a.dy=e.y,a.m+=.7*n.m,a},a.newPlan=function(){this.x=Math.floor(Math.random()*a.w),this.y=Math.floor(Math.random()*a.h),this.dx=Math.random()-.5,this.dy=Math.random()-.5,this.m=.1*a.maxSize+Math.floor(Math.random()*(a.maxSize-.1*a.maxSize))},a.explSun=function(){bootbox.alert({title:"Including a Sun",message:"Check this box to include a sun. The sun: <ul><li>Can be any size</li><li>Will always be in the middle of your 'system'.</li><li>Is indestructable. Anything coliding with it will be destroyed, regardless of mass ratio.</li></ul>"})},a.plans=[],a.Math=Math,a.getStyles=function(n,l){var t="";return t+=l?"width:"+a.maxSize+"px;height:"+a.maxSize+"px;":"width:"+20*n/a.maxSize+"px;height:"+20*n/a.maxSize+"px;",t+="background:hsl("+60*n/a.maxSize+",100%,"+100*n/a.maxSize+"%);",t+="box-shadow:0 0 "+Math.ceil(n/5)+"px "+Math.ceil(n/10)+"px hsl("+60*n/a.maxSize+",100%,"+100*n/a.maxSize+"%);"},a.toggleSun=function(){console.log("sun status",a.useSun),a.sunStatus=a.useSun,a.useSun&&(a.sun={m:a.mSun,x:a.w/2-a.mSun/2,y:a.h/2-a.mSun/2})}}]);