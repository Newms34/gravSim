"use strict";var app=angular.module("gravapp",[]).controller("grav-cont",["$scope","$interval",function(a,n){a.w=$(window).width(),a.h=$(window).height(),a.ticks=0,a.numPlans=15,a.maxSize=100,a.g=.1,a.timer=null,a.sunStatus=!1,a.mSun=200,a.canv=document.querySelector("#canv").getContext("2d"),a.rescatter=function(){a.plans=[],a.hidePlans=!1;for(var t=0;t<a.numPlans;t++)a.plans.push(new a.newPlan);a.plans.forEach(function(n){n.x=Math.floor(Math.random()*a.w),n.y=Math.floor(Math.random()*a.h),n.dx=Math.random()-.5,n.dy=Math.random()-.5}),a.timer=n(function(){a.ticks++;for(var t=a.plans.length,l=0;l<t;l++){if(!a.plans[l])return!1;if(!a.plans[l])return!1;(a.plans[l].x+a.plans[l].dx<0||a.plans[l].x+a.plans[l].dx>a.w)&&(a.plans[l].dx*=-1),(a.plans[l].y+a.plans[l].dy<0||a.plans[l].y+a.plans[l].dy>a.h)&&(a.plans[l].dy*=-1),a.plans[l].x+=a.plans[l].dx,a.plans[l].y+=a.plans[l].dy;for(var s=0;s<t;s++)if(l!=s&&(!(e=a.getGrav(a.plans[l],a.plans[s]))||0==e||"false"==e)){!0,console.log("Objects",a.plans[l],"and",a.plans[s],"merged!"),a.plans[l]=a.combine(a.plans[l],a.plans[s]),a.plans.splice(s,1);break}if(a.sunStatus){var e=a.getGrav(a.plans[l],a.sun,!0);e&&"false"!=e||a.plans.splice(l,1)}if(a.pathMode){a.canv.globalCompositeOperation="screen",a.canv.fillStyle="hsla("+60*a.plans[l].m/a.maxSize+",100%,"+100*a.plans[l].m/a.maxSize+"%,.2)";var o=Math.ceil(a.plans[l].m/8);a.canv.fillRect(a.plans[l].x+.05*a.plans[l].m,a.plans[l].y+.05*a.plans[l].m,o,o)}}a.ticks%5==0&&(a.canv.globalCompositeOperation="multiply",a.canv.fillStyle="rgba(0,0,0,0.1)",a.canv.fillRect(0,0,a.w,a.h)),(a.plans.length<2||a.sunStatus&&!a.plans.length)&&(n.cancel(a.timer),bootbox.alert({title:"System Crashed!",message:"Your system has only one particle left!"}))},50)},a.getGrav=function(n,t,l){var s=10*n.m/a.maxSize,e=10*t.m/a.maxSize;l&&(e=sun.m/2);var o=Math.sqrt(Math.pow(Math.abs(n.x-t.x),2)+Math.pow(Math.abs(n.y-t.y),2));if(o<s+e)return console.log("COLLIDE! DIST IS:",o,"MIN RANGE IS",s+e),!1;console.log("REG: DIST IS:",o,"MIN RANGE IS",s+e);var i=a.g*t.m/Math.pow(o,2),r=Math.atan(Math.abs(n.y-t.y)/Math.abs(n.x-t.x));return n.x>=t.x&&n.y<=t.y||(r=n.x<t.x&&n.y<=t.y?Math.PI-r:n.x>=t.x&&n.y>t.y?2*Math.PI-r:Math.PI+r),r=2*Math.PI-r,n.dx-=i*Math.cos(r),n.dy-=i*Math.sin(r),n.dx=Math.min(20,n.dx),n.dy=Math.min(20,n.dy),n},a.combine=function(a,n){if(n.m>a.m){var t=angular.copy(n);n=angular.copy(a),a=angular.copy(t)}var l={x:.5*a.m*Math.pow(a.dx,2)+.5*n.m*Math.pow(n.dx,2),y:.5*a.m*Math.pow(a.dy,2)+.5*n.m*Math.pow(n.dy,2)},s={x:.7*l.x/(a.m+n.m),y:.7*l.y/(a.m+n.m)};return console.log("COLLISION:",a,n,l,s),a.dx=s.x,a.dy=s.y,a.m+=.7*n.m,a},a.newPlan=function(){this.x=Math.floor(Math.random()*a.w),this.y=Math.floor(Math.random()*a.h),this.dx=Math.random()-.5,this.dy=Math.random()-.5,this.m=.1*a.maxSize+Math.floor(Math.random()*(a.maxSize-.1*a.maxSize))},a.explSun=function(){bootbox.alert({title:"Including a Sun",message:"Check this box to include a sun. The sun: <ul><li>Can be any size</li><li>Will always be in the middle of your 'system'.</li><li>Is indestructable. Anything coliding with it will be destroyed, regardless of mass ratio.</li></ul>"})},a.plans=[],a.Math=Math,a.getStyles=function(n,t){var l="";return l+=t?"width:"+a.maxSize+"px;height:"+a.maxSize+"px;":"width:"+20*n/a.maxSize+"px;height:"+20*n/a.maxSize+"px;",l+="background:hsl("+60*n/a.maxSize+",100%,"+100*n/a.maxSize+"%);",l+="box-shadow:0 0 "+Math.ceil(n/5)+"px "+Math.ceil(n/10)+"px hsl("+60*n/a.maxSize+",100%,"+100*n/a.maxSize+"%);"},a.toggleSun=function(){console.log("sun status",a.useSun),a.sunStatus=a.useSun,a.useSun&&(a.sun={m:a.mSun,x:a.w/2-a.mSun/2,y:a.h/2-a.mSun/2})}}]);